/**
 * File:
 *   disk.ycp
 *
 * Module:
 *   Configuration of disk
 *
 * Summary:
 *   Main file
 *
 * Authors:
 *   Michael Hager <mike@suse.de>
 *
 * $Id$
 *
 * Wrapper file for inst_disk.ycp
 * 
 */

{

// sample target map used for testing

boolean config_mode = false;

////////////////////////////////////////////////////////////////////////////////  
//                           TESTCASES
////////////////////////////////////////////////////////////////////////////////  
 map test_linux_and_win = $[
  "/dev/hda":
	$[
	  "bus" : "IDE", "cyl_count" : 53040, "cyl_size" : 516096,
	  "device" : "/dev/hda", "name" : "1. IDE, 25.49 GB, /dev/hda, (empty)",
	  //"partitions" : [ ],
	  "partitions" : [
			  $[
			    //"create" : true,
			    "crypt_fs" : false,
			    "crypt_key" : "",
			    //"format" : true,
			    "fsid" : 6,
			    "fstype" : "Fat32",
			    //"mount" : "",
			    "nr" : 1,
			    "ori_nr" : 1,
			    "region" : [
					0,
					10001
			    ],
			    "type" : `primary,
			    "used_fs" : `fat32
			  ],
			    $[
			      //"create" : true,
			      "crypt_fs" : false,
			      "crypt_key" : "",
			      //"format" : true,
			      "fsid" : 15,
			      "fstype" : "Extended",
			      //"mount" : nil,
			      "nr" : 2,
			      "ori_nr" : 2,
			      "region" : [
					  10001,
					  43039
			      ],
			      "type" : `extended,
			      "used_fs" : `unknown
			    ],
			    $[
			      //"create" : true,
			      "crypt_fs" : false,
			      "crypt_key" : "",
			      //"format" : true,
			      "fsid" : 130,
			      "fstype" : "Linux swap",
			      "mount" : "swap",
			      "nr" : 6,
			      "ori_nr" : 6,
			      "region" : [
					  10021,
					  180
			      ],
			      "type" : `logical,
			      "used_fs" : `swap
			    ],
			    $[
			      //"create" : true,
			      "crypt_fs" : false,
			      "crypt_key" : "",
			      //"format" : true,
			      "fsid" : 131,
			      "fstype" : "Linux native",
			      //"mount" : "",
			      "nr" : 5,
			      "ori_nr" : 5,
			      "region" : [
					  10001,
					  20
			      ],
			      "type" : `logical,
			      "used_fs" : `ext2
			    ],
			    $[
			      //"create" : true,
			      "crypt_fs" : false,
			      "crypt_key" : "",
			      //"format" : true,
			      "fsid" : 131,
			      "fstype" : "Linux native",
			      //"mount" : "",
			      "nr" : 7,
			      "ori_nr" : 7,
			      "region" : [
					  10201,
					  29800
			      ],
			      "type" : `logical,
			      "used_fs" : `ext2
			    ]
	  ],
			    
	  "vendor" : "WDC"
	]
 ];

   map test_free_space2 = $[
  "/dev/hdb":
	$[
	  "bus" : "IDE", "cyl_count" : 53040, "cyl_size" : 516096,
	  "device" : "/dev/hdb", "name" : "2. IDE, 25.49 GB, /dev/hdb, (windows)",
	  "partitions" : [
	    $["fsid" : 12, "fstype" : "FAT12",
	      "nr" : 1, "region" : [ 30, 5130 ], "type" : `primary
	    ],
	    $["fsid" : 131, "fstype" : "FAT12",
	      "nr" : 2, "region" : [ 5161, 6000 ], "type" : `primary
	    ]
	  ],
	  "vendor" : "WDC"
	]
  ];
   map test_free_space = $[
  "/dev/hdb":
	$[
	  "bus" : "IDE", "cyl_count" : 5304, "cyl_size" : 5160960,
	  "device" : "/dev/hdb", "name" : "2. IDE, 25.49 GB, /dev/hdb, (windows)",
	  "partitions" : [
	    $["fsid" : 131, "fstype" : "Linux",
	      "nr" : 4, "region" : [ 12, 3 ], "type" : `primary
	    ],
	    $["fsid" : 12, "fstype" : "FAT12",
	      "nr" : 1, "region" : [ 23, 493 ], "type" : `primary
	    ],
	    $["fsid" : 131, "fstype" : "Linux",
	      "nr" : 2, "region" : [ 516, 1200 ], "type" : `primary
	    ]
	  ],
	  "vendor" : "WDC"
	]
  ];

   
   
   map test_winonly = $[
  "/dev/hdc":
	$[
	  "bus" : "IDE", "cyl_count" : 53040, "cyl_size" : 516096,
	  "device" : "/dev/hdc", "name" : "3. IDE, 25.49 GB, /dev/hdc, (windows full)",
	  "partitions" : [
	    $["fsid" : 12, "fstype" : "FAT32",
	      "nr" : 1, "region" : [ 10, 53030 ], "type" : `primary
	      ]
	  ],
	  "vendor" : "WDC"
	]
   ];

   map test_4winonly = $[
  "/dev/hdd":
	$[
	  "bus" : "IDE", "cyl_count" : 53040, "cyl_size" : 516096,
	  "device" : "/dev/hdc", "name" : "4. IDE, 25.49 GB, /dev/hdd, (full)",
	  "partitions" : [
	    $["fsid" : 4, "fstype" : "FAT16",
	      "nr" : 1, "region" : [ 0, 513 ], "type" : `primary
	      ],
	    $["fsid" : 4, "fstype" : "FAT16",
	      "nr" : 2, "region" : [ 513, 513 ], "type" : `primary
	      ],
	    $["fsid" : 4, "fstype" : "FAT16",
	      "nr" : 3, "region" : [ 1026, 513 ], "type" : `primary
	      ],
	    $["fsid" : 4, "fstype" : "FAT16",
	      "nr" : 4, "region" : [ 1539, 51500 ], "type" : `primary
	      ]
	  ],
	  "vendor" : "WDC"
	]
   ];

   
   map test_treated = $[
  "/dev/sda":
        $[
		"bus":"SCSI",
		"name":"1. SCSI, 8.54 GB, /dev/sda, IBM-DNES-309170W",
		"device":"/dev/sda",
		"cyl_count":11141,                               
		"cyl_size":1048576,                            
		"vendor":"IBM DNES-309170W",                      
		"partitions":[
			      $["fsid":131,	// YES: mount
			       "mount":"/boot",		
			       "fstype":"Linux native",
			       "nr":1,
			       "region":[0, 50],
			       "format":true,
			       "type":`primary,
			       "used_fs": `ext2 ],
			      $["delete":true,	// NO: no mount
			       "fsid":130,
			       "fstype":"Linux swap",
			       "nr":2,
			       "region":[50, 200],
			       "type":`primary],
			      $["create":false,	// NO: create false
			       "fsid":131,
			       "mount":"/var",
			       "fstype":"Linux native",
			       "nr":3,
			       "region":[250, 500],
			       "type":`primary],
			      $["create":true,  	// YES: create true + mount  
			       "fsid":131,
			       "mount":"/",
			       "nr":4,
			       "fstype":"Linux native",
			       "format":true,
			       "region":[750, 10391],
			       "used_fs": `reiser,
			       "type":`primary
			      ]
		]
	]
   ];

   map test_treated2 = $[
  "/dev/sdb":
        $[
		"bus":"SCSI",
		"name":"2. SCSI, 8.54 GB, /dev/sdb, IBM-DNES-309170W",
		"device":"/dev/sdb",
		"cyl_count":11141,                               
		"cyl_size":1048576,                            
		"vendor":"IBM DNES-309170-XEW",                      
		"partitions":[
			      $["fsid":131,		// NO: nothing
			       "fstype":"Linux native",
			       "nr":1,
			       "region":[0, 200],
			       "type":`primary],
			      $["create":true,		// NO: no mount
			       "fsid":130,
			       "fstype":"Linux swap",
			       "nr":2,
			       "region":[200, 250],
			       "type":`primary],
			      $["delete":true,		// NO: delete true
			       "fsid":131,
			       "mount":"/var",
			       "fstype":"Linux native",
			       "nr":3,
			       "region":[450, 1200],
			       "type":`primary],
			      $[ "delete":false, 	 	// YES: delete false
			       "fsid":130,
			       "fstype":"Linux swap", // user-visible string
			       "nr":4,	// partition number, as seen by linux (!)
			       "region": [1650, 9491], // start of region and number of cyl.s
			       "use":true,  // mark as 'used' in inst_target_partition
			       "type":`primary	
			      ]
		]
	]
  ];
  
  map test_LinuxDisk = $[
  "/dev/sdc" :
	$[
	  "bus" : "SCSI",
	  "cyl_count" : 8748,
	  "cyl_size" : 1048576,
	  "device" : "/dev/sdc",
	  "name" : "3. SCSI, 8.54 GB, /dev/sdc, (apple)",
	  "partitions" : [
	    $["fsid" : 130, "fstype" : "Linux swap",
	      "nr" : 1, "region" : [ 0, 513 ], "type" : `pdisk
	    ],
	    $["fsid" : 131,"fstype" : "Linux native",
	      "nr" : 2, "region" : [ 513, 8235 ], "type" : `pdisk
	    ]
	  ],
	  "vendor" : "IBM"
	]
  ];

  
/***
 * <h3>Configuration of the disk</h3>
 */

   textdomain "storage";

   import "Storage";

   map targetMap = test_free_space;
   Storage::SetTargetMap( targetMap ); 
   Mode::test = true;

   Storage::SetTestsuite( true );

   import "BootLILO";
   BootLILO::lba_support = false;

   include "partitioning/do_proposal.ycp";

   map ret = Storage::GetTargetMap();
   Storage::SetTargetMap( targetMap );
   ret = do_proposal();

}   
